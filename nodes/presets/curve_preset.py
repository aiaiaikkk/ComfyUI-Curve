"""
曲线预设节点

提供各种风格的预设曲线：
- 基础风格预设
- 对比度系列
- 电影级调色
- 胶片风格
- 日系风格
- 港风系列
- 社交媒体风格
- 时尚摄影
- 艺术风格
- 特殊效果
- 季节主题
"""

import torch

from ..core.base_node import BaseImageNode


class CurvePresetNode(BaseImageNode):
    """曲线预设节点 - 提供各种风格的预设曲线"""
    
    @classmethod
    def INPUT_TYPES(cls):
        return {
            'required': {
                'preset_style': ([
                    'Linear (无调整)',
                    
                    # 基础风格（效果明显）
                    '人像专用', '风景专用', '夜景专用',
                    
                    # 对比度系列（效果最明显）
                    '高对比度', '超高对比', '柔和对比', '暗调风格', '亮调风格',
                    
                    # 电影级调色（风格化强烈）
                    '电影蓝橙', '赛博朋克', '末日废土', '复古电影', '现代电影',
                    
                    # 胶片风格（复古感强烈）
                    'VSCO经典', '柯达胶片', '富士胶片', '宝丽来', '黑白胶片',
                    
                    # 日系风格（清新明显）
                    '日系清新', '日系通透', '日系奶油', '日系森系',
                    
                    # 港风系列（复古港片）
                    '港风经典', '港风暗调', '港风霓虹',
                    
                    # 社交媒体风格
                    '小红书', 'Instagram', 'TikTok流行',
                    
                    # 时尚摄影
                    '时尚杂志', '高级灰', '莫兰迪色', '奶茶色',
                    
                    # 艺术风格
                    '油画质感', '水彩画', '素描风格', '版画效果',
                    
                    # 特殊效果（效果强烈）
                    '梦幻紫调', '青春活力', '商业摄影', '婚纱摄影', '街拍风格',
                    
                    # 季节主题
                    '春日暖阳', '夏日清凉', '秋日金黄', '冬日雪景',
                    
                    # 极端效果（测试用）
                    '极端提亮', '极端压暗', '反转效果', 'S型增强',
                    
                    # === 人像摄影 ===
                    '人像美颜', '人像质感', '人像柔光',
                    
                    # === 风景摄影 ===
                    '风景增强', '自然风光', '山水画意',
                    
                    # === 电影风格 ===
                    '电影胶片', '电影冷调', '电影暖调',
                    
                    # === 复古风格 ===
                    '复古胶片', '复古暖调', '怀旧色调',
                    
                    # === 现代风格 ===
                    '现代简约', '科技感', '未来主义',
                ], {'default': 'Linear (无调整)'}),
            },
            'hidden': {'unique_id': 'UNIQUE_ID'}
        }
    
    RETURN_TYPES = ('STRING', 'STRING')
    RETURN_NAMES = ('curve_points', 'suggested_channel')
    FUNCTION = 'get_preset_curve'
    CATEGORY = 'Image/Presets'
    OUTPUT_NODE = False
    
    @classmethod
    def IS_CHANGED(cls, preset_style, unique_id=None):
        return f"{preset_style}"

    def get_preset_curves(self):
        """定义各种风格的预设曲线 - 优化版本，效果更明显"""
        return {
            'Linear (无调整)': '0,0;255,255',
            
            # === 基础风格（效果明显） ===
            '人像专用': '0,15;64,85;128,155;192,210;255,245',  # 提亮肤色，柔化对比
            '风景专用': '0,0;32,15;96,75;160,185;224,245;255,255',  # 增强天空和植物对比
            '夜景专用': '0,25;48,80;96,130;160,190;224,230;255,250',  # 大幅提亮暗部细节
            
            # === 对比度系列（效果最明显） ===
            '高对比度': '0,0;48,25;128,128;208,230;255,255',  # 强烈S型曲线
            '超高对比': '0,0;64,15;128,128;192,240;255,255',  # 极端对比效果
            '柔和对比': '0,20;64,80;128,140;192,200;255,240',  # 温和提升对比
            '暗调风格': '0,0;64,35;128,85;192,140;255,200',  # 整体压暗，营造氛围
            '亮调风格': '0,50;64,100;128,170;192,220;255,255',  # 大幅提亮，清新风格
            
            # === 电影级调色（风格化强烈） ===
            '电影蓝橙': '0,10;48,35;96,80;160,180;208,235;255,250',  # 经典电影色调
            '赛博朋克': '0,0;32,15;96,60;160,200;224,250;255,255',  # 科幻冷调
            '末日废土': '0,0;64,40;128,95;192,150;255,210',  # 荒凉暗调
            '复古电影': '0,5;48,45;96,90;160,170;224,220;255,245',  # 复古暖调
            '现代电影': '0,0;64,50;128,120;192,200;255,255',  # 现代冷调
            
            # === 胶片风格（复古感强烈） ===
            'VSCO经典': '0,20;32,50;96,110;160,180;224,230;255,245',  # 经典VSCO效果
            '柯达胶片': '0,25;48,70;96,125;160,185;224,230;255,245',  # 暖调胶片
            '富士胶片': '0,15;64,85;128,150;192,210;255,245',  # 清新胶片
            '宝丽来': '0,35;48,85;96,140;160,190;224,225;255,240',  # 复古即时成像
            '黑白胶片': '0,0;48,35;96,80;160,175;224,230;255,255',  # 黑白胶片质感
            
            # === 日系风格（清新明显） ===
            '日系清新': '0,35;64,100;128,170;192,225;255,250',  # 更明亮清新，与冬日雪景区分
            '日系通透': '0,40;48,90;96,145;144,190;192,225;255,250',  # 通透明亮
            '日系奶油': '0,45;48,100;96,155;144,200;192,235;255,250',  # 奶油质感
            '日系森系': '0,20;64,80;128,145;192,200;255,240',  # 更自然，与春日暖阳区分
            
            # === 港风系列（复古港片） ===
            '港风经典': '0,0;48,25;96,70;160,170;208,220;255,250',  # 经典港片色调
            '港风暗调': '0,0;32,10;96,55;160,140;224,190;255,230',  # 深沉港风
            '港风霓虹': '0,10;48,35;96,75;160,190;208,240;255,255',  # 霓虹夜景
            
            # === 社交媒体风格 ===
            '小红书': '0,30;64,90;128,155;192,220;255,250',  # 更温暖明亮，强化小红书特色
            'Instagram': '0,15;48,70;96,125;160,180;224,230;255,250',  # 更时尚现代，强化INS特色
            'TikTok流行': '0,15;64,90;128,160;192,220;255,248',  # 年轻活力
            
            # === 时尚摄影 ===
            '时尚杂志': '0,0;48,30;96,75;160,185;208,235;255,255',  # 时尚大片
            '高级灰': '0,25;64,80;128,135;192,190;255,240',  # 高级灰调
            '莫兰迪色': '0,40;64,95;128,150;192,205;255,235',  # 莫兰迪色调
            '奶茶色': '0,35;48,85;96,140;160,190;224,225;255,240',  # 温暖奶茶色
            
            # === 艺术风格 ===
            '油画质感': '0,10;48,60;96,115;160,170;224,220;255,245',  # 油画厚重感
            '水彩画': '0,40;64,105;128,170;192,220;255,245',  # 水彩透明感
            '素描风格': '0,0;64,45;128,105;192,165;255,220',  # 素描对比
            '版画效果': '0,0;32,15;96,65;160,155;224,210;255,240',  # 版画质感
            
            # === 特殊效果（效果强烈） ===
            '梦幻紫调': '0,20;48,75;96,135;160,190;224,235;255,250',  # 梦幻感
            '青春活力': '0,30;64,100;128,170;192,225;255,250',  # 活力四射
            '商业摄影': '0,5;48,55;96,105;160,185;224,240;255,255',  # 商业质感
            '婚纱摄影': '0,40;64,105;128,170;192,225;255,248',  # 更浪漫梦幻，与其他区分
            '街拍风格': '0,15;48,70;96,125;160,185;224,230;255,245',  # 街头感
            
            # === 季节主题 ===
            '春日暖阳': '0,30;64,95;128,165;192,220;255,245',  # 更温暖，与日系森系区分
            '夏日清凉': '0,20;48,80;96,140;160,200;224,240;255,250',  # 夏日清爽
            '秋日金黄': '0,15;48,65;96,115;160,175;224,225;255,245',  # 秋日金色
            '冬日雪景': '0,25;64,90;128,160;192,215;255,250',  # 调整为更冷峻，与日系清新区分
            
            # === 极端效果（测试用） ===
            '极端提亮': '0,80;64,140;128,190;192,230;255,255',  # 极端提亮效果
            '极端压暗': '0,0;64,20;128,60;192,120;255,180',  # 极端压暗效果
            '反转效果': '0,255;64,192;128,128;192,64;255,0',  # 反转色调
            'S型增强': '0,0;32,5;96,50;160,205;224,250;255,255',  # 强烈S型
            
            # === 人像摄影 ===
            '人像美颜': '0,25;48,85;96,140;160,190;224,230;255,245',  # 柔和美颜，与其他区分
            '人像质感': '0,10;48,60;96,110;160,175;224,225;255,250',  # 质感人像
            '人像柔光': '0,35;64,100;128,165;192,215;255,240',  # 柔光效果
            
            # === 风景摄影 ===
            '风景增强': '0,5;48,55;96,110;160,180;224,235;255,255',  # 风景对比增强，与商业摄影区分
            '自然风光': '0,15;64,85;128,150;192,205;255,245',  # 自然色彩
            '山水画意': '0,20;48,75;96,130;160,185;224,220;255,240',  # 山水意境
            
            # === 电影风格 ===
            '电影胶片': '0,15;48,65;96,120;160,175;224,215;255,240',  # 胶片质感，与秋日金黄区分
            '电影冷调': '0,0;48,30;96,80;160,160;224,210;255,245',  # 冷色调电影
            '电影暖调': '0,20;48,75;96,125;160,185;224,230;255,250',  # 暖色调电影
            
            # === 复古风格 ===
            '复古胶片': '0,10;48,55;96,105;160,165;224,205;255,235',  # 复古胶片，与电影胶片区分
            '复古暖调': '0,25;48,80;96,135;160,190;224,225;255,245',  # 复古暖色，与人像美颜区分
            '怀旧色调': '0,5;48,50;96,100;160,160;224,200;255,230',  # 怀旧感
            
            # === 现代风格 ===
            '现代简约': '0,20;64,85;128,145;192,200;255,245',  # 简约现代，与日系森系区分
            '科技感': '0,0;48,25;96,75;160,175;224,235;255,255',  # 科技冷峻，与港风经典区分
            '未来主义': '0,10;48,40;96,85;160,185;224,240;255,255',  # 未来感
        }

    def get_suggested_channels(self):
        """定义每种风格的建议通道"""
        return {
            'Linear (无调整)': 'RGB',
            
            # === 基础风格 ===
            '人像专用': 'RGB',          # RGB总体调整适合人像
            '风景专用': 'RGB',          # RGB适合整体风景
            '夜景专用': 'RGB',          # RGB适合夜景整体提亮
            
            # === 对比度系列 ===
            '高对比度': 'RGB',         # RGB通道增强整体对比
            '超高对比': 'RGB',         # RGB通道强烈对比
            '柔和对比': 'RGB',         # RGB通道柔和对比
            '暗调风格': 'RGB',         # RGB通道整体压暗
            '亮调风格': 'RGB',         # RGB通道整体提亮
            
            # === 电影级调色 ===
            '电影蓝橙': 'Blue',        # 蓝色通道强化蓝橙对比
            '赛博朋克': 'Blue',        # 蓝色通道突出科幻冷调
            '末日废土': 'Red',         # 红色通道营造荒凉感
            '复古电影': 'Red',         # 红色通道复古暖调
            '现代电影': 'Blue',        # 蓝色通道现代冷调
            
            # === 胶片风格 ===
            'VSCO经典': 'RGB',         # RGB经典胶片效果
            '柯达胶片': 'Red',         # 红色通道暖调胶片
            '富士胶片': 'Green',       # 绿色通道清新胶片
            '宝丽来': 'RGB',           # RGB复古即时成像
            '黑白胶片': 'RGB',         # RGB黑白质感
            
            # === 日系风格 ===
            '日系清新': 'Green',       # 绿色通道清新自然
            '日系通透': 'RGB',         # RGB通透明亮
            '日系奶油': 'Red',         # 红色通道奶油质感
            '日系森系': 'Green',       # 绿色通道森系自然
            
            # === 港风系列 ===
            '港风经典': 'Red',         # 红色通道经典港片
            '港风暗调': 'RGB',         # RGB深沉港风
            '港风霓虹': 'Blue',        # 蓝色通道霓虹夜景
            
            # === 社交媒体风格 ===
            '小红书': 'Red',           # 红色通道温暖明亮
            'Instagram': 'RGB',        # RGB时尚现代
            'TikTok流行': 'RGB',       # RGB年轻活力
            
            # === 时尚摄影 ===
            '时尚杂志': 'RGB',         # RGB时尚大片
            '高级灰': 'RGB',           # RGB高级灰调
            '莫兰迪色': 'RGB',         # RGB莫兰迪色调
            '奶茶色': 'Red',           # 红色通道温暖奶茶色
            
            # === 艺术风格 ===
            '油画质感': 'Red',         # 红色通道油画厚重感
            '水彩画': 'RGB',           # RGB水彩透明感
            '素描风格': 'RGB',         # RGB素描对比
            '版画效果': 'RGB',         # RGB版画质感
            
            # === 特殊效果 ===
            '梦幻紫调': 'Blue',        # 蓝色通道梦幻感
            '青春活力': 'Green',       # 绿色通道活力四射
            '商业摄影': 'RGB',         # RGB商业质感
            '婚纱摄影': 'RGB',         # RGB浪漫梦幻
            '街拍风格': 'RGB',         # RGB街头感
            
            # === 季节主题 ===
            '春日暖阳': 'Red',         # 红色通道温暖春日
            '夏日清凉': 'Blue',        # 蓝色通道夏日清爽
            '秋日金黄': 'Red',         # 红色通道秋日金色
            '冬日雪景': 'Blue',        # 蓝色通道冬日冷峻
            
            # === 极端效果 ===
            '极端提亮': 'RGB',         # RGB极端提亮
            '极端压暗': 'RGB',         # RGB极端压暗
            '反转效果': 'RGB',         # RGB反转色调
            'S型增强': 'RGB',          # RGB强烈S型
            
            # === 人像摄影 ===
            '人像美颜': 'Red',         # 红色通道柔和美颜
            '人像质感': 'RGB',         # RGB质感人像
            '人像柔光': 'RGB',         # RGB柔光效果
            
            # === 风景摄影 ===
            '风景增强': 'Green',       # 绿色通道风景对比
            '自然风光': 'Green',       # 绿色通道自然色彩
            '山水画意': 'RGB',         # RGB山水意境
            
            # === 电影风格 ===
            '电影胶片': 'RGB',         # RGB胶片质感
            '电影冷调': 'Blue',        # 蓝色通道冷色调
            '电影暖调': 'Red',         # 红色通道暖色调
            
            # === 复古风格 ===
            '复古胶片': 'Red',         # 红色通道复古胶片
            '复古暖调': 'Red',         # 红色通道复古暖色
            '怀旧色调': 'RGB',         # RGB怀旧感
            
            # === 现代风格 ===
            '现代简约': 'RGB',         # RGB简约现代
            '科技感': 'Blue',          # 蓝色通道科技冷峻
            '未来主义': 'Blue',        # 蓝色通道未来感
        }

    def get_preset_curve(self, preset_style, unique_id=None):
        """获取预设曲线和建议通道"""
        try:
            # 获取预设曲线点
            preset_curves = self.get_preset_curves()
            curve_points = preset_curves.get(preset_style, '0,0;255,255')
            
            # 获取建议通道
            suggested_channels = self.get_suggested_channels()
            suggested_channel = suggested_channels.get(preset_style, 'RGB')
            
            return (curve_points, suggested_channel)
            
        except Exception as e:
            print(f"CurvePresetNode error: {e}")
            return ('0,0;255,255', 'RGB')